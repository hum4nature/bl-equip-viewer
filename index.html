<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BL4 Equipment Editor</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/equipment.css">
    <link rel="stylesheet" href="css/customize-dialog.css">
    <link rel="stylesheet" href="css/str-weak.css">
    <link rel="stylesheet" href="css/notes.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Source Sans 3', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #050b0d;
            color: rgb(136, 138, 156);
            min-height: 100vh;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            margin-bottom: 24px;
        }
        
        .header h1 {
            color: #fff;
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .edit-mode-toggle {
            margin-bottom: 24px;
        }
        
        .edit-mode-toggle button {
            background-color: #0b181e;
            color: rgb(136, 138, 156);
            border: 1px solid rgb(150, 148, 171);
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .edit-mode-toggle button:hover {
            background-color: rgb(150, 148, 171);
        }
        
        .edit-mode-toggle button.active {
            background-color: #5ec753;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>Borderlands 4 - Equipment Editor</h1>
        </div>
        
        <div class="edit-mode-toggle">
            <button id="editModeToggle" class="active">Edit Mode: ON</button>
        </div>
        
        <!-- Equipment Section -->
        <div id="equipment-container" class="equipment equipment--editable">
            <!-- Will be populated by equipment.js -->
        </div>
        
        <!-- Strengths & Weaknesses Section -->
        <div id="str-weak-container" class="str-weak">
            <!-- Will be populated by str-weak-handler.js -->
        </div>
        
        <!-- Notes Section -->
        <div id="notes-container" class="notes">
            <!-- Will be populated by notes-handler.js -->
        </div>
    </div>
    
    <!-- Customize Dialog (hidden by default) -->
    <div id="customize-dialog" class="customize-dialog" style="display: none;">
        <!-- Will be populated by customize-dialog.js -->
    </div>
    
    <!-- Load game data first -->
    <script type="module" src="js/game-data.js"></script>
    
    <!-- Load utility functions -->
    <script type="module" src="js/utils.js"></script>
    
    <!-- Load handlers -->
    <script type="module" src="js/equipment.js"></script>
    <script type="module" src="js/customize-dialog.js"></script>
    <script type="module" src="js/select-dialog.js"></script>
    <script type="module" src="js/augment-selector.js"></script>
    <script type="module" src="js/str-weak-handler.js"></script>
    <script type="module" src="js/notes-handler.js"></script>
    <script type="module" src="js/firmware-handler.js"></script>
    
    <!-- Main app initialization -->
    <script type="module">
        import { loadGameData } from './js/game-data.js';
        import { Equipment } from './js/equipment.js';
        import CustomizeDialog from './js/customize-dialog.js';
        import { StrWeakHandler } from './js/str-weak-handler.js';
        import { NotesHandler } from './js/notes-handler.js';
        
        let gameData = null;
        let equipment = null;
        let customizeDialog = null;
        let strWeakHandler = null;
        let notesHandler = null;
        
        async function init() {
            console.log('Loading game data...');
            gameData = await loadGameData();
            console.log('Game data loaded:', gameData);
            
            // Initialize equipment
            equipment = new Equipment('equipment-container', gameData);
            equipment.setEditable(true);
            
            // Initialize customize dialog
            customizeDialog = new CustomizeDialog('customize-dialog', gameData);
            
            // Connect equipment to dialog
            equipment.onSlotClick((slotId, currentItem) => {
                customizeDialog.open(slotId, currentItem, (updatedItem) => {
                    equipment.setItem(slotId, updatedItem);
                });
            });
            
            // Initialize strengths/weaknesses
            strWeakHandler = new StrWeakHandler('str-weak-container', equipment);
            
            // Initialize notes
            notesHandler = new NotesHandler('notes-container');
            
            // Update strengths/weaknesses when equipment changes
            equipment.onSlotClick(() => {
                // This will be called when slots are clicked, but we also need to update on item changes
            });
            
            // Override setItem to update strengths/weaknesses
            const originalSetItem = equipment.setItem.bind(equipment);
            equipment.setItem = (slotId, item) => {
                originalSetItem(slotId, item);
                if (strWeakHandler) {
                    strWeakHandler.update();
                }
            };
            
            // Edit mode toggle
            const editToggle = document.getElementById('editModeToggle');
            editToggle.addEventListener('click', () => {
                const isEditable = equipment.isEditable();
                equipment.setEditable(!isEditable);
                editToggle.textContent = `Edit Mode: ${!isEditable ? 'ON' : 'OFF'}`;
                editToggle.classList.toggle('active', !isEditable);
            });
            
            console.log('Equipment Editor initialized');
        }
        
        init().catch(console.error);
    </script>
</body>
</html>

